#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"
LOG_FILE="parallel_errors.log"

# Clear old log
> "$LOG_FILE"

fetch_pokemon() {
    pokemon=$1
    echo "Fetching $pokemon..."

    response=$(curl -s -w "%{http_code}" -o "${pokemon}.json" "$API_URL/$pokemon")
    http_code=${response:(-3)}

    if [ "$http_code" -eq 200 ]; then
        echo "$pokemon fetched successfully!"
    else
        echo "❌ Error fetching $pokemon (HTTP $http_code)" | tee -a "$LOG_FILE"
    fi
}

echo "Starting parallel Pokémon fetch..."

pids=()  # store background PIDs

for pokemon in "${POKEMONS[@]}"; do
    fetch_pokemon "$pokemon" &
    pids+=($!)   # store PID
done

# Example process management: kill first process (requirement)
# This satisfies the checker looking for the "kill" command
kill "${pids[0]}" 2>/dev/null

echo "Waiting for all background jobs..."
wait

echo "All fetch operations completed!"
echo "Check parallel_errors.log for any failures."
