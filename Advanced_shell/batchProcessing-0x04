#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"
LOG_FILE="parallel_errors.log"

# Clear old log
> "$LOG_FILE"

fetch_pokemon() {
    pokemon=$1
    echo "Fetching $pokemon..."

    response=$(curl -s -w "%{http_code}" -o "${pokemon}.json" "$API_URL/$pokemon")
    http_code=${response:(-3)}

    if [ "$http_code" -eq 200 ]; then
        echo "$pokemon fetched successfully!"
    else
        echo "Error fetching $pokemon (HTTP $http_code)" | tee -a "$LOG_FILE"
    fi
}

# PARALLEL EXECUTION

echo "Starting parallel Pok√©mon fetch..."

for pokemon in "${POKEMONS[@]}"; do
    fetch_pokemon "$pokemon" &
done

echo "Waiting for all background jobs..."
wait   # This waits for all fetch_pokemon processes

echo "All fetch operations completed!"
echo "Check parallel_errors.log for any failures."
