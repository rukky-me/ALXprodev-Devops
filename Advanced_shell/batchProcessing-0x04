#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"
LOG_FILE="errors.log"

# Clear previous log
> "$LOG_FILE"

for pokemon in "${POKEMONS[@]}"; do
    echo "Fetching data for $pokemon..."

    retries=0
    success=false

    while [ $retries -lt 3 ]; do
        response=$(curl -s -w "%{http_code}" -o "${pokemon}.json" "$API_URL/$pokemon")

        http_code=${response:(-3)}  # last 3 chars = HTTP status code

        # If success (HTTP 200)
        if [ "$http_code" -eq 200 ]; then
            echo "$pokemon fetched successfully!"
            success=true
            break
        else
            retries=$((retries + 1))
            echo "Attempt $retries for $pokemon failed (HTTP $http_code). Retrying..."
            sleep 2
        fi
    done

    # If failed after 3 attempts
    if [ "$success" = false ]; then
        echo "Failed to fetch $pokemon after 3 attempts." | tee -a "$LOG_FILE"
    fi

    # Anti-rate limit delay
    sleep 1
done

echo "Done. Check errors.log if any Pok√©mon failed."
